(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-721521ca"],{"24e3":function(t,e,i){"use strict";var a=i("2bae"),s=i.n(a);s.a},"2bae":function(t,e,i){},"35ca":function(t,e,i){"use strict";var a,s,n,h=i("bc3a"),r=i.n(h);void 0===a?(s="https://spotilize.herokuapp.com",n=""):(s=a.baseURL,n=a.serverPort);var o=s+n+"/users",c=()=>{return r.a.create({baseURL:o})};e["a"]={fetchUsers(){return c().get("/")},createUser(t){return c().post("/add",t)},deleteUser(t){return c().delete(`/delete/${t}`)},getUser(t){return c().get(`/${t}`)},loginUser(t){return c().post("/login",t)},updateToken(t,e){return c().put(`/updateToken/${t}`,e)},getUserImage(t){return c().get(`/image/${t}`)}}},6319:function(t,e,i){"use strict";const a=256,s={MIN:15,MAX:80},n={MIN:.2,MAX:1},h={MIN:.8,MAX:.9},r={MIN:.001,MAX:.005},o={MIN:1,MAX:1.25},c=["#69D2E7","#1B676B","#BEF202","#EBE54D","#00CDAC","#1693A5","#F9D423","#FF4E50","#E7204E","#0CCABA","#FF006F"];function d(t,e){return l(t)?t[~~(Math.random()*t.length)]:(u(e)||(e=t||1,t=0),t+Math.random()*(e-t))}function l(t){return"[object Array]"==Object.prototype.toString.call(t)}function u(t){return"number"==typeof t}var g=class{constructor(t=0,e=0){this.x=t,this.y=e,this.reset()}reset(){return this.level=1+Math.floor(d(4)),this.scale=d(s.MIN,s.MAX),this.alpha=d(h.MIN,h.MAX),this.speed=d(n.MIN,n.MAX),this.color=d(c),this.size=d(o.MIN,o.MAX),this.spin=d(r.MAX,r.MAX),this.band=Math.floor(d(a)),d()<.5&&(this.spin=-this.spin),this.smoothedScale=0,this.smoothedAlpha=0,this.decayScale=0,this.decayAlpha=0,this.rotation=d(2*Math.PI),this.energy=0}move(){return this.rotation+=this.spin,this.y-=this.speed/1.5*this.level}draw(t){var e,i,a;return i=Math.exp(this.energy),a=this.scale*i,e=this.alpha*this.energy*1.5,this.decayScale=Math.max(this.decayScale,a),this.decayAlpha=Math.max(this.decayAlpha,e),this.smoothedScale+=.3*(this.decayScale-this.smoothedScale),this.smoothedAlpha+=.3*(this.decayAlpha-this.smoothedAlpha),this.decayScale*=.985,this.decayAlpha*=.975,t.save(),t.beginPath(),t.translate(this.x+250*Math.cos(this.rotation*this.speed),this.y),t.rotate(this.rotation),t.scale(this.smoothedScale*(this.level/2.5),this.smoothedScale*(this.level/2.5)),t.moveTo(.5*this.size,0),t.lineTo(-.5*this.size,0),t.lineWidth=1,t.lineCap="round",t.globalAlpha=this.smoothedAlpha/this.level,t.strokeStyle=this.color,t.stroke(),t.restore()}};e["a"]=g},f3fc:function(t,e,i){"use strict";i.r(e);var a,s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"vis",attrs:{id:"visualizer"}},[i("canvas",{attrs:{id:"canvas1"}}),i("b-modal",{ref:"myModalRef",staticStyle:{color:"black","text-align":"center"},attrs:{"ok-only":"",title:"Whoops..."}},[i("p",[t._v("Click the Spotilize extension button in the Chrome toolbar to start the visualizer!")])]),i("b-modal",[i("canvas",{attrs:{id:"oCan"}})]),i("image",{staticStyle:{display:"none"},attrs:{id:"imgSent"}})],1)},n=[],h=i("2f94"),r=i("35ca"),o=(i("355f"),i("6319")),c=(i("c75a"),Object({NODE_ENV:"production",BASE_URL:"/"}).chromeId||a.chromeId),d={data(){return{token:"",trackId:"",trackName:"",trackDuration:0,transferred:!1,isPaused:!1,NUM_PARTICLES:200,particles:[],height:null,width:null,ratio:null,ctx:null,bands:null,prevEnergy:[],requestid:null,visCanvas:HTMLElement,MODEL_URLS:"/models",dWidth:Number,dHeight:Number,streaming:Boolean,video:null,dStream:null,dCanvas:null,photoToSend:null,refImage:HTMLImageElement,faceMatcher:null}},sockets:{playerReady:function(t){this.token=t.token.access_token,this.playerId=t.player_id,!1===this.transferred&&this.transfer()},stateChanged:function(t){!0!==t.state.paused&&this.trackId!==t.state.track_window.current_track.id&&(this.trackId=t.state.track_window.current_track.id,this.trackName=t.state.track_window.current_track.name,!1===this.transferred&&this.transfer()),!0===t.state.paused?this.isPaused=!0:this.isPaused=!1},tokenRefreshed:function(t){this.token=t.token},paused:function(){},played:function(){}},created(){chrome.runtime.sendMessage(c,"listening",t=>{t?!1===t.listening&&this.$refs.myModalRef.show():this.$router.replace({name:"home"})}),this.bands=null,this.dWidth=600,this.dHeight=0,this.streaming=!1,window.addEventListener("message",t=>{t.source==window&&((t.data.type="frequency_data")&&(this.bands=t.data.data),(t.data.type="fullScreenDone")&&this.sizeCanvas())})},beforeDestroy(){this.NUM_PARTICLES=150,this.particles=[],this.bands=null,this.ctx=null,this.visCanvas=null,window.cancelAnimationFrame(this.requestid)},mounted(){this.visCanvas=document.getElementById("canvas1"),this.video=document.createElement("video"),this.dCanvas=document.getElementById("oCan"),this.loadFaceAPI(),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(t=>{this.dStream=t,this.video.srcObject=t}).catch(t=>{console.log("An error occured: "+t)}),this.video.addEventListener("canplay",t=>{this.streaming||(this.dHeight=this.video.videoHeight/(this.video.videoWidth/this.dWidth),this.video.setAttribute("width",this.dWidth),this.video.setAttribute("height",this.dHeight),this.dCanvas.setAttribute("width",this.dWidth),this.dCanvas.setAttribute("height",this.dHeight),this.streaming=!0,this.video.play(),this.onPlay(this.video))},!1),this.clearPhoto(),this.sizeCanvas()},methods:{clearPhoto(){var t=this.dCanvas.getContext("2d");t.fillStyle="#AAA",t.fillRect(0,0,this.dCanvas.width,this.dCanvas.height);this.dCanvas.toDataURL("image/png")},async loadFaceAPI(){console.log("Email: "+localStorage.email);const t=await r["a"].getUserImage(localStorage.email);!0===t.data.success&&(this.refImage=new Image,this.refImage.src=t.data.image),await faceapi.loadTinyFaceDetectorModel(this.MODEL_URLS),await faceapi.loadFaceLandmarkModel(this.MODEL_URLS),await faceapi.loadFaceRecognitionModel(this.MODEL_URLS),console.log("Detecting faces in ref image");const e=await faceapi.detectAllFaces(this.refImage,new faceapi.TinyFaceDetectorOptions).withFaceLandmarks().withFaceDescriptors();e.length&&(this.faceMatcher=new faceapi.FaceMatcher(e),console.log("face api loaded"))},async onPlay(t){const e=await faceapi.detectSingleFace(t,new faceapi.TinyFaceDetectorOptions).withFaceLandmarks().withFaceDescriptor();if(e){const t=this.faceMatcher.findBestMatch(e.descriptor);console.log("Recognize: "+t.toString());var i=t.toString();console.log("person includes unknown: "+i.includes("Unknown")),!1===i.includes("Unknown")&&this.takePicture()}setTimeout(()=>this.onPlay(t),1500)},takePicture(){console.log("taking picture"),console.log(this.dWidth+" "+this.dHeight);var t=this.dCanvas.getContext("2d");if(this.dWidth&&this.dHeight){this.dCanvas.width=this.dWidth,this.dCanvas.height=this.dHeight,t.drawImage(this.video,0,0,this.dWidth,this.dHeight);var e=this.dCanvas.toDataURL("image/png");console.log("sending picture"),this.$socket.emit("image",{image:e})}else this.clearPhoto()},sizeCanvas(){this.ratio=window.devicePixelRatio,this.height=window.innerHeight,this.width=window.innerWidth,null!==this.visCanvas&&void 0!==this.visCanvas&&(this.visCanvas.setAttribute("height",this.height*this.ratio),this.visCanvas.setAttribute("width",this.width*this.ratio),this.ctx=this.visCanvas.getContext("2d"),this.ctx.globalCompositeOperation="lighter")},async transfer(){const t=await h["a"].transferDevicePlayer({id:localStorage.device_id,access_token:localStorage.access_token,play:!0});!0===t.data.success&&(this.setup(),this.transferred=!0)},async getTrackInfo(){const t=await h["a"].getTrackInfo(localStorage.access_token,this.trackId);t.data.success},async analyze(){const t=await h["a"].analyzeTrack(localStorage.access_token,this.trackId);t.data.success},setup(){var t,e,i,a;for(t=0;t<=this.NUM_PARTICLES-1;t++)i=this.random(this.width),a=this.random(this.height),e=new o["a"](i,a),e.energy=this.random(e.band/256),this.particles.push(e);this.requestid=requestAnimationFrame(this.draw)},draw(){this.ctx.clearRect(0,0,this.width*this.ratio,this.height*this.ratio),this.update(),this.requestid=requestAnimationFrame(this.draw)},update(){let t;for(let e=0;e<this.particles.length;e++)t=this.particles[e],void 0!==this.bands&&null!==this.bands&&(t.energy=this.bands[t.band]/256),t.y<-t.size*t.level*t.scale&&(t.reset(),t.x=this.random(this.width),t.y=this.height+t.size*t.scale*t.level),t.move(),t.draw(this.ctx)},random(t,e){return this.isArray(t)?t[~~(Math.random()*t.length)]:(this.isNumber(e)||(e=t||1,t=0),t+Math.random()*(e-t))},isArray(t){return"[object Array]"==Object.prototype.toString.call(t)},isNumber(t){return"number"==typeof t}}},l=d,u=(i("24e3"),i("2877")),g=Object(u["a"])(l,s,n,!1,null,"59c2572c",null);g.options.__file="Visualizer.vue";e["default"]=g.exports}}]);
//# sourceMappingURL=chunk-721521ca.2c85b8f2.js.map